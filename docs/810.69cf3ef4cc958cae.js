"use strict";(self.webpackChunkpoc_gpt=self.webpackChunkpoc_gpt||[]).push([[810],{2213:(os,An,$)=>{$.r(An),$.d(An,{ChatModule:()=>as});var xt={};$.r(xt),$.d(xt,{APIConnectionError:()=>ye,APIConnectionTimeoutError:()=>Be,APIError:()=>P,APIUserAbortError:()=>T,AuthenticationError:()=>Wt,BadRequestError:()=>qt,ConflictError:()=>Vt,InternalServerError:()=>zt,NotFoundError:()=>Xt,OpenAIError:()=>y,PermissionDeniedError:()=>Ht,RateLimitError:()=>Gt,UnprocessableEntityError:()=>Jt});var Rt=$(6895),Cn=$(3321),h=$(5861),fe=(()=>{return(r=fe||(fe={})).USER="USER",r.BOT="BOT",fe;var r})(),w=$(4650);function M(r){var e,t,n,s=2;for(typeof Symbol<"u"&&(t=Symbol.asyncIterator,n=Symbol.iterator);s--;){if(t&&null!=(e=r[t]))return e.call(r);if(n&&null!=(e=r[n]))return new Me(e.call(r));t="@@asyncIterator",n="@@iterator"}throw new TypeError("Object is not async iterable")}function Me(r){function e(t){if(Object(t)!==t)return Promise.reject(new TypeError(t+" is not an object."));var n=t.done;return Promise.resolve(t.value).then(function(s){return{value:s,done:n}})}return(Me=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return e(this.n.apply(this.s,arguments))},return:function(n){var s=this.s.return;return void 0===s?Promise.resolve({value:n,done:!0}):e(s.apply(this.s,arguments))},throw:function(n){var s=this.s.return;return void 0===s?Promise.reject(n):e(s.apply(this.s,arguments))}},new Me(r)}function Sn(r,e){this.v=r,this.k=e}function R(r){return new Sn(r,0)}function pe(r){var e,t;function n(i,a){try{var o=r[i](a),l=o.value,c=l instanceof Sn;Promise.resolve(c?l.v:l).then(function(u){if(c){var p="return"===i?"return":"next";if(!l.k||u.done)return n(p,u);u=r[p](u).value}s(o.done?"return":"normal",u)},function(u){n("throw",u)})}catch(u){s("throw",u)}}function s(i,a){switch(i){case"return":e.resolve({value:a,done:!0});break;case"throw":e.reject(a);break;default:e.resolve({value:a,done:!1})}(e=e.next)?n(e.key,e.arg):t=null}this._invoke=function(i,a){return new Promise(function(o,l){var c={key:i,arg:a,resolve:o,reject:l,next:null};t?t=t.next=c:(e=t=c,n(i,a))})},"function"!=typeof r.return&&(this.return=void 0)}function te(r){return function(){return new pe(r.apply(this,arguments))}}pe.prototype["function"==typeof Symbol&&Symbol.asyncIterator||"@@asyncIterator"]=function(){return this},pe.prototype.next=function(r){return this._invoke("next",r)},pe.prototype.throw=function(r){return this._invoke("throw",r)},pe.prototype.return=function(r){return this._invoke("return",r)};const ae="4.52.3";let me,Pn,xn,Ot,Rn,In,On,kt,kn,En=!1,ur=null,dr=null,hr=null,fr=null;class mr{constructor(e){this.body=e}get[Symbol.toStringTag](){return"MultipartBody"}}me||function pr(r,e={auto:!1}){if(En)throw new Error(`you must \`import 'openai/shims/${r.kind}'\` before importing anything else from openai`);if(me)throw new Error(`can't \`import 'openai/shims/${r.kind}'\` after \`import 'openai/shims/${me}'\``);En=e.auto,me=r.kind,Pn=r.fetch,ur=r.Request,dr=r.Response,hr=r.Headers,xn=r.FormData,fr=r.Blob,Ot=r.File,Rn=r.ReadableStream,In=r.getMultipartRequestOptions,On=r.getDefaultAgent,kt=r.fileFromPath,kn=r.isFsReadStream}(function gr({manuallyImported:r}={}){const e=r?"You may need to use polyfills":"Add one of these imports before your first `import \u2026 from 'openai'`:\n- `import 'openai/shims/node'` (if you're running on Node)\n- `import 'openai/shims/web'` (otherwise)\n";let t,n,s,i;try{t=fetch,n=Request,s=Response,i=Headers}catch(a){throw new Error(`this environment is missing the following Web Fetch API type: ${a.message}. ${e}`)}return{kind:"web",fetch:t,Request:n,Response:s,Headers:i,FormData:typeof FormData<"u"?FormData:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'FormData' is undefined. ${e}`)}},Blob:typeof Blob<"u"?Blob:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'Blob' is undefined. ${e}`)}},File:typeof File<"u"?File:class{constructor(){throw new Error(`file uploads aren't supported in this environment yet as 'File' is undefined. ${e}`)}},ReadableStream:typeof ReadableStream<"u"?ReadableStream:class{constructor(){throw new Error(`streaming isn't supported in this environment yet as 'ReadableStream' is undefined. ${e}`)}},getMultipartRequestOptions:(a=(0,h.Z)(function*(o,l){return{...l,body:new mr(o)}}),function(l,c){return a.apply(this,arguments)}),getDefaultAgent:a=>{},fileFromPath:()=>{throw new Error("The `fileFromPath` function is only supported in Node. See the README for more details: https://www.github.com/openai/openai-node#file-uploads")},isFsReadStream:a=>!1};var a}(),{auto:!0});class G{constructor(e,t){this.iterator=e,this.controller=t}static fromSSEResponse(e,t){let n=!1;function i(){return i=te(function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let a=!1;try{var c,o=!1,l=!1;try{for(var p,u=M(function _r(r,e){return Mt.apply(this,arguments)}(e,t));o=!(p=yield R(u.next())).done;o=!1){const f=p.value;if(!a)if(f.data.startsWith("[DONE]"))a=!0;else if(null===f.event){let d;try{d=JSON.parse(f.data)}catch(g){throw console.error("Could not parse message into JSON:",f.data),console.error("From chunk:",f.raw),g}if(d&&d.error)throw new P(void 0,d.error,void 0,void 0);yield d}else{let d;try{d=JSON.parse(f.data)}catch(g){throw console.error("Could not parse message into JSON:",f.data),console.error("From chunk:",f.raw),g}if("error"==f.event)throw new P(void 0,d.error,d.message,void 0);yield{event:f.event,data:d}}}}catch(f){l=!0,c=f}finally{try{o&&null!=u.return&&(yield R(u.return()))}finally{if(l)throw c}}a=!0}catch(f){if(f instanceof Error&&"AbortError"===f.name)return;throw f}finally{a||t.abort()}}),i.apply(this,arguments)}return new G(function s(){return i.apply(this,arguments)},t)}static fromReadableStream(e,t){let n=!1;function i(){return(i=te(function*(){const l=new ne,c=Mn(e);var f,u=!1,p=!1;try{for(var g,d=M(c);u=!(g=yield R(d.next())).done;u=!1){const A=g.value;for(const b of l.decode(A))yield b}}catch(A){p=!0,f=A}finally{try{u&&null!=d.return&&(yield R(d.return()))}finally{if(p)throw f}}for(const A of l.flush())yield A})).apply(this,arguments)}function o(){return o=te(function*(){if(n)throw new Error("Cannot iterate over a consumed stream, use `.tee()` to split the stream.");n=!0;let l=!1;try{var p,c=!1,u=!1;try{for(var d,f=M(function s(){return i.apply(this,arguments)}());c=!(d=yield R(f.next())).done;c=!1){const g=d.value;l||g&&(yield JSON.parse(g))}}catch(g){u=!0,p=g}finally{try{c&&null!=f.return&&(yield R(f.return()))}finally{if(u)throw p}}l=!0}catch(g){if(g instanceof Error&&"AbortError"===g.name)return;throw g}finally{l||t.abort()}}),o.apply(this,arguments)}return new G(function a(){return o.apply(this,arguments)},t)}[Symbol.asyncIterator](){return this.iterator()}tee(){const e=[],t=[],n=this.iterator(),s=i=>({next:()=>{if(0===i.length){const a=n.next();e.push(a),t.push(a)}return i.shift()}});return[new G(()=>s(e),this.controller),new G(()=>s(t),this.controller)]}toReadableStream(){const e=this;let t;const n=new TextEncoder;return new Rn({start:()=>(0,h.Z)(function*(){t=e[Symbol.asyncIterator]()})(),pull:s=>(0,h.Z)(function*(){try{const{value:i,done:a}=yield t.next();if(a)return s.close();const o=n.encode(JSON.stringify(i)+"\n");s.enqueue(o)}catch(i){s.error(i)}})(),cancel:()=>(0,h.Z)(function*(){yield t.return?.()})()})}}function Mt(){return Mt=te(function*(r,e){if(!r.body)throw e.abort(),new y("Attempted to iterate over a response with no body");const t=new br,n=new ne,s=Mn(r.body);var o,i=!1,a=!1;try{for(var c,l=M(function yr(r){return Tt.apply(this,arguments)}(s));i=!(c=yield R(l.next())).done;i=!1){const u=c.value;for(const p of n.decode(u)){const f=t.decode(p);f&&(yield f)}}}catch(u){a=!0,o=u}finally{try{i&&null!=l.return&&(yield R(l.return()))}finally{if(a)throw o}}for(const u of n.flush()){const p=t.decode(u);p&&(yield p)}}),Mt.apply(this,arguments)}function Tt(){return(Tt=te(function*(r){let e=new Uint8Array;var s,t=!1,n=!1;try{for(var a,i=M(r);t=!(a=yield R(i.next())).done;t=!1){const o=a.value;{if(null==o)continue;const l=o instanceof ArrayBuffer?new Uint8Array(o):"string"==typeof o?(new TextEncoder).encode(o):o;let u,c=new Uint8Array(e.length+l.length);for(c.set(e),c.set(l,e.length),e=c;-1!==(u=wr(e));)yield e.slice(0,u),e=e.slice(u)}}}catch(o){n=!0,s=o}finally{try{t&&null!=i.return&&(yield R(i.return()))}finally{if(n)throw s}}e.length>0&&(yield e)})).apply(this,arguments)}function wr(r){for(let n=0;n<r.length-2;n++){if(10===r[n]&&10===r[n+1]||13===r[n]&&13===r[n+1])return n+2;if(13===r[n]&&10===r[n+1]&&n+3<r.length&&13===r[n+2]&&10===r[n+3])return n+4}return-1}class br{constructor(){this.event=null,this.data=[],this.chunks=[]}decode(e){if(e.endsWith("\r")&&(e=e.substring(0,e.length-1)),!e){if(!this.event&&!this.data.length)return null;const i={event:this.event,data:this.data.join("\n"),raw:this.chunks};return this.event=null,this.data=[],this.chunks=[],i}if(this.chunks.push(e),e.startsWith(":"))return null;let[t,n,s]=function vr(r,e){const t=r.indexOf(e);return-1!==t?[r.substring(0,t),e,r.substring(t+e.length)]:[r,"",""]}(e,":");return s.startsWith(" ")&&(s=s.substring(1)),"event"===t?this.event=s:"data"===t&&this.data.push(s),null}}class ne{constructor(){this.buffer=[],this.trailingCR=!1}decode(e){let t=this.decodeText(e);if(this.trailingCR&&(t="\r"+t,this.trailingCR=!1),t.endsWith("\r")&&(this.trailingCR=!0,t=t.slice(0,-1)),!t)return[];const n=ne.NEWLINE_CHARS.has(t[t.length-1]||"");let s=t.split(ne.NEWLINE_REGEXP);return n&&s.pop(),1!==s.length||n?(this.buffer.length>0&&(s=[this.buffer.join("")+s[0],...s.slice(1)],this.buffer=[]),n||(this.buffer=[s.pop()||""]),s):(this.buffer.push(s[0]),[])}decodeText(e){if(null==e)return"";if("string"==typeof e)return e;if(typeof Buffer<"u"){if(e instanceof Buffer)return e.toString();if(e instanceof Uint8Array)return Buffer.from(e).toString();throw new y(`Unexpected: received non-Uint8Array (${e.constructor.name}) stream chunk in an environment with a global "Buffer" defined, which this library assumes to be Node. Please report this error.`)}if(typeof TextDecoder<"u"){if(e instanceof Uint8Array||e instanceof ArrayBuffer)return this.textDecoder??(this.textDecoder=new TextDecoder("utf8")),this.textDecoder.decode(e);throw new y(`Unexpected: received non-Uint8Array/ArrayBuffer (${e.constructor.name}) in a web platform. Please report this error.`)}throw new y("Unexpected: neither Buffer nor TextDecoder are available as globals. Please report this error.")}flush(){if(!this.buffer.length&&!this.trailingCR)return[];const e=[this.buffer.join("")];return this.buffer=[],this.trailingCR=!1,e}}function Mn(r){if(r[Symbol.asyncIterator])return r;const e=r.getReader();return{next:()=>(0,h.Z)(function*(){try{const t=yield e.read();return t?.done&&e.releaseLock(),t}catch(t){throw e.releaseLock(),t}})(),return:()=>(0,h.Z)(function*(){const t=e.cancel();return e.releaseLock(),yield t,{done:!0,value:void 0}})(),[Symbol.asyncIterator](){return this}}}ne.NEWLINE_CHARS=new Set(["\n","\r"]),ne.NEWLINE_REGEXP=/\r\n|[\n\r]/g;const Tn=r=>null!=r&&"object"==typeof r&&"string"==typeof r.url&&"function"==typeof r.blob,Fn=r=>null!=r&&"object"==typeof r&&"string"==typeof r.name&&"number"==typeof r.lastModified&&Ft(r),Ft=r=>null!=r&&"object"==typeof r&&"number"==typeof r.size&&"string"==typeof r.type&&"function"==typeof r.text&&"function"==typeof r.slice&&"function"==typeof r.arrayBuffer;function $t(r,e,t){return Bt.apply(this,arguments)}function Bt(){return Bt=(0,h.Z)(function*(r,e,t){if(r=yield r,t??(t=Fn(r)?{lastModified:r.lastModified,type:r.type}:{}),Tn(r)){const s=yield r.blob();return e||(e=new URL(r.url).pathname.split(/[\\/]/).pop()??"unknown_file"),new Ot([s],e,t)}const n=yield function Ar(r){return jt.apply(this,arguments)}(r);if(e||(e=function Sr(r){return Nt(r.name)||Nt(r.filename)||Nt(r.path)?.split(/[\\/]/).pop()}(r)??"unknown_file"),!t.type){const s=n[0]?.type;"string"==typeof s&&(t={...t,type:s})}return new Ot(n,e,t)}),Bt.apply(this,arguments)}function jt(){return(jt=(0,h.Z)(function*(r){let e=[];if("string"==typeof r||ArrayBuffer.isView(r)||r instanceof ArrayBuffer)e.push(r);else if(Ft(r))e.push(yield r.arrayBuffer());else{if(!Er(r))throw new Error(`Unexpected data type: ${typeof r}; constructor: ${r?.constructor?.name}; props: ${function Cr(r){return`[${Object.getOwnPropertyNames(r).map(t=>`"${t}"`).join(", ")}]`}(r)}`);var s,t=!1,n=!1;try{for(var a,i=M(r);t=!(a=yield i.next()).done;t=!1)e.push(a.value)}catch(o){n=!0,s=o}finally{try{t&&null!=i.return&&(yield i.return())}finally{if(n)throw s}}}return e})).apply(this,arguments)}const Nt=r=>"string"==typeof r?r:typeof Buffer<"u"&&r instanceof Buffer?String(r):void 0,Er=r=>null!=r&&"object"==typeof r&&"function"==typeof r[Symbol.asyncIterator],Bn=r=>r&&"object"==typeof r&&r.body&&"MultipartBody"===r[Symbol.toStringTag],ge=function(){var r=(0,h.Z)(function*(e){const t=yield Pr(e.body);return In(t,e)});return function(t){return r.apply(this,arguments)}}(),Pr=function(){var r=(0,h.Z)(function*(e){const t=new xn;return yield Promise.all(Object.entries(e||{}).map(([n,s])=>Dt(t,n,s))),t});return function(t){return r.apply(this,arguments)}}(),Dt=function(){var r=(0,h.Z)(function*(e,t,n){if(void 0!==n){if(null==n)throw new TypeError(`Received null for "${t}"; to pass null in FormData, you must use the string 'null'`);if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)e.append(t,String(n));else if((r=>Fn(r)||Tn(r)||kn(r))(n)){const s=yield $t(n);e.append(t,s)}else if(Array.isArray(n))yield Promise.all(n.map(s=>Dt(e,t+"[]",s)));else{if("object"!=typeof n)throw new TypeError(`Invalid value given to form, expected a string, number, boolean, object, Array, File or Blob but got ${n} instead`);yield Promise.all(Object.entries(n).map(([s,i])=>Dt(e,`${t}[${s}]`,i)))}}});return function(t,n,s){return r.apply(this,arguments)}}();var Te;function Nn(r){return Lt.apply(this,arguments)}function Lt(){return(Lt=(0,h.Z)(function*(r){const{response:e}=r;if(r.options.stream)return oe("response",e.status,e.url,e.headers,e.body),r.options.__streamClass?r.options.__streamClass.fromSSEResponse(e,r.controller):G.fromSSEResponse(e,r.controller);if(204===e.status)return null;if(r.options.__binaryResponse)return e;const t=e.headers.get("content-type");if(t?.includes("application/json")||t?.includes("application/vnd.api+json")){const i=yield e.json();return oe("response",e.status,e.url,e.headers,i),i}const s=yield e.text();return oe("response",e.status,e.url,e.headers,s),s})).apply(this,arguments)}class Fe extends Promise{constructor(e,t=Nn){super(n=>{n(null)}),this.responsePromise=e,this.parseResponse=t}_thenUnwrap(e){var t=this;return new Fe(this.responsePromise,function(){var n=(0,h.Z)(function*(s){return e(yield t.parseResponse(s))});return function(s){return n.apply(this,arguments)}}())}asResponse(){return this.responsePromise.then(e=>e.response)}withResponse(){var e=this;return(0,h.Z)(function*(){const[t,n]=yield Promise.all([e.parse(),e.asResponse()]);return{data:t,response:n}})()}parse(){return this.parsedPromise||(this.parsedPromise=this.responsePromise.then(this.parseResponse)),this.parsedPromise}then(e,t){return this.parse().then(e,t)}catch(e){return this.parse().catch(e)}finally(e){return this.parse().finally(e)}}class Ir{constructor({baseURL:e,maxRetries:t=2,timeout:n=6e5,httpAgent:s,fetch:i}){this.baseURL=e,this.maxRetries=Zt("maxRetries",t),this.timeout=Zt("timeout",n),this.httpAgent=s,this.fetch=i??Pn}authHeaders(e){return{}}defaultHeaders(e){return{Accept:"application/json","Content-Type":"application/json","User-Agent":this.getUserAgent(),...$r(),...this.authHeaders(e)}}validateHeaders(e,t){}defaultIdempotencyKey(){return`stainless-node-retry-${Ur()}`}get(e,t){return this.methodRequest("get",e,t)}post(e,t){return this.methodRequest("post",e,t)}patch(e,t){return this.methodRequest("patch",e,t)}put(e,t){return this.methodRequest("put",e,t)}delete(e,t){return this.methodRequest("delete",e,t)}methodRequest(e,t,n){return this.request(Promise.resolve(n).then(function(){var s=(0,h.Z)(function*(i){const a=i&&Ft(i?.body)?new DataView(yield i.body.arrayBuffer()):i?.body instanceof DataView?i.body:i?.body instanceof ArrayBuffer?new DataView(i.body):i&&ArrayBuffer.isView(i?.body)?new DataView(i.body.buffer):i?.body;return{method:e,path:t,...i,body:a}});return function(i){return s.apply(this,arguments)}}()))}getAPIList(e,t,n){return this.requestAPIList(t,{method:"get",path:e,...n})}calculateContentLength(e){if("string"==typeof e){if(typeof Buffer<"u")return Buffer.byteLength(e,"utf8").toString();if(typeof TextEncoder<"u")return(new TextEncoder).encode(e).length.toString()}else if(ArrayBuffer.isView(e))return e.byteLength.toString();return null}buildRequest(e){const{method:t,path:n,query:s,headers:i={}}=e,a=ArrayBuffer.isView(e.body)||e.__binaryRequest&&"string"==typeof e.body?e.body:Bn(e.body)?e.body.body:e.body?JSON.stringify(e.body,null,2):null,o=this.calculateContentLength(a),l=this.buildURL(n,s);"timeout"in e&&Zt("timeout",e.timeout);const c=e.timeout??this.timeout,u=e.httpAgent??this.httpAgent??On(l),p=c+1e3;return"number"==typeof u?.options?.timeout&&p>(u.options.timeout??0)&&(u.options.timeout=p),this.idempotencyHeader&&"get"!==t&&(e.idempotencyKey||(e.idempotencyKey=this.defaultIdempotencyKey()),i[this.idempotencyHeader]=e.idempotencyKey),{req:{method:t,...a&&{body:a},headers:this.buildHeaders({options:e,headers:i,contentLength:o}),...u&&{agent:u},signal:e.signal??null},url:l,timeout:c}}buildHeaders({options:e,headers:t,contentLength:n}){const s={};return n&&(s["content-length"]=n),Hn(s,this.defaultHeaders(e)),Hn(s,t),Bn(e.body)&&"node"!==me&&delete s["content-type"],this.validateHeaders(s,t),s}prepareOptions(e){return(0,h.Z)(function*(){})()}prepareRequest(e,{}){return(0,h.Z)(function*(){})()}parseHeaders(e){return e?Symbol.iterator in e?Object.fromEntries(Array.from(e).map(t=>[...t])):{...e}:{}}makeStatusError(e,t,n,s){return P.generate(e,t,n,s)}request(e,t=null){return new Fe(this.makeRequest(e,t))}makeRequest(e,t){var n=this;return(0,h.Z)(function*(){const s=yield e;null==t&&(t=s.maxRetries??n.maxRetries),yield n.prepareOptions(s);const{req:i,url:a,timeout:o}=n.buildRequest(s);if(yield n.prepareRequest(i,{url:a,options:s}),oe("request",a,s,i.headers),s.signal?.aborted)throw new T;const l=new AbortController,c=yield n.fetchWithTimeout(a,i,o,l).catch(Ut);if(c instanceof Error){if(s.signal?.aborted)throw new T;if(t)return n.retryRequest(s,t);throw"AbortError"===c.name?new Be:new ye({cause:c})}const u=kr(c.headers);if(!c.ok){if(t&&n.shouldRetry(c))return oe(`response (error; retrying, ${t} attempts remaining)`,c.status,a,u),n.retryRequest(s,t,u);const p=yield c.text().catch(b=>Ut(b).message),f=Br(p),d=f?void 0:p;throw oe(`response (error; ${t?"(error; no more retries left)":"(error; not retryable)"})`,c.status,a,u,d),n.makeStatusError(c.status,f,d,u)}return{response:c,options:s,controller:l}})()}requestAPIList(e,t){const n=this.makeRequest(t,null);return new Or(this,n,e)}buildURL(e,t){const n=Nr(e)?new URL(e):new URL(this.baseURL+(this.baseURL.endsWith("/")&&e.startsWith("/")?e.slice(1):e)),s=this.defaultQuery();return qn(s)||(t={...s,...t}),"object"==typeof t&&t&&!Array.isArray(t)&&(n.search=this.stringifyQuery(t)),n.toString()}stringifyQuery(e){return Object.entries(e).filter(([t,n])=>typeof n<"u").map(([t,n])=>{if("string"==typeof n||"number"==typeof n||"boolean"==typeof n)return`${encodeURIComponent(t)}=${encodeURIComponent(n)}`;if(null===n)return`${encodeURIComponent(t)}=`;throw new y(`Cannot stringify type ${typeof n}; Expected string, number, boolean, or null. If you need to pass nested query parameters, you can manually encode them, e.g. { query: { 'foo[key1]': value1, 'foo[key2]': value2 } }, and please open a GitHub issue requesting better support for your use case.`)}).join("&")}fetchWithTimeout(e,t,n,s){var i=this;return(0,h.Z)(function*(){const{signal:a,...o}=t||{};a&&a.addEventListener("abort",()=>s.abort());const l=setTimeout(()=>s.abort(),n);return i.getRequestClient().fetch.call(void 0,e,{signal:s.signal,...o}).finally(()=>{clearTimeout(l)})})()}getRequestClient(){return{fetch:this.fetch}}shouldRetry(e){const t=e.headers.get("x-should-retry");return"true"===t||"false"!==t&&(408===e.status||409===e.status||429===e.status||e.status>=500)}retryRequest(e,t,n){var s=this;return(0,h.Z)(function*(){let i;const a=n?.["retry-after-ms"];if(a){const l=parseFloat(a);Number.isNaN(l)||(i=l)}const o=n?.["retry-after"];if(o&&!i){const l=parseFloat(o);i=Number.isNaN(l)?Date.parse(o)-Date.now():1e3*l}return i&&0<=i&&i<6e4||(i=s.calculateDefaultRetryTimeoutMillis(t,e.maxRetries??s.maxRetries)),yield _e(i),s.makeRequest(e,t-1)})()}calculateDefaultRetryTimeoutMillis(e,t){return Math.min(.5*Math.pow(2,t-e),8)*(1-.25*Math.random())*1e3}getUserAgent(){return`${this.constructor.name}/JS ${ae}`}}class Dn{constructor(e,t,n,s){Te.set(this,void 0),function(r,e,t,n,s){if("function"==typeof e||!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");e.set(r,t)}(this,Te,e),this.options=s,this.response=t,this.body=n}hasNextPage(){return!!this.getPaginatedItems().length&&null!=this.nextPageInfo()}getNextPage(){var e=this;return(0,h.Z)(function*(){const t=e.nextPageInfo();if(!t)throw new y("No next page expected; please check `.hasNextPage()` before calling `.getNextPage()`.");const n={...e.options};if("params"in t&&"object"==typeof n.query)n.query={...n.query,...t.params};else if("url"in t){const s=[...Object.entries(n.query||{}),...t.url.searchParams.entries()];for(const[i,a]of s)t.url.searchParams.set(i,a);n.query=void 0,n.path=t.url.toString()}return yield function(r,e,t,n){if("function"==typeof e||!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return e.get(r)}(e,Te).requestAPIList(e.constructor,n)})()}iterPages(){var e=this;return te(function*(){let t=e;for(yield t;t.hasNextPage();)t=yield R(t.getNextPage()),yield t})()}[(Te=new WeakMap,Symbol.asyncIterator)](){var e=this;return te(function*(){var s,t=!1,n=!1;try{for(var a,i=M(e.iterPages());t=!(a=yield R(i.next())).done;t=!1){const o=a.value;for(const l of o.getPaginatedItems())yield l}}catch(o){n=!0,s=o}finally{try{t&&null!=i.return&&(yield R(i.return()))}finally{if(n)throw s}}})()}}class Or extends Fe{constructor(e,t,n){super(t,function(){var s=(0,h.Z)(function*(i){return new n(e,i.response,yield Nn(i),i.options)});return function(i){return s.apply(this,arguments)}}())}[Symbol.asyncIterator](){var e=this;return te(function*(){const t=yield R(e);var i,n=!1,s=!1;try{for(var o,a=M(t);n=!(o=yield R(a.next())).done;n=!1)yield o.value}catch(l){s=!0,i=l}finally{try{n&&null!=a.return&&(yield R(a.return()))}finally{if(s)throw i}}})()}}const kr=r=>new Proxy(Object.fromEntries(r.entries()),{get(e,t){const n=t.toString();return e[n.toLowerCase()]||e[n]}}),Mr={method:!0,path:!0,query:!0,body:!0,headers:!0,maxRetries:!0,stream:!0,timeout:!0,httpAgent:!0,signal:!0,idempotencyKey:!0,__binaryRequest:!0,__binaryResponse:!0,__streamClass:!0},B=r=>"object"==typeof r&&null!==r&&!qn(r)&&Object.keys(r).every(e=>Wn(Mr,e)),Ln=r=>"x32"===r?"x32":"x86_64"===r||"x64"===r?"x64":"arm"===r?"arm":"aarch64"===r||"arm64"===r?"arm64":r?`other:${r}`:"unknown",Zn=r=>(r=r.toLowerCase()).includes("ios")?"iOS":"android"===r?"Android":"darwin"===r?"MacOS":"win32"===r?"Windows":"freebsd"===r?"FreeBSD":"openbsd"===r?"OpenBSD":"linux"===r?"Linux":r?`Other:${r}`:"Unknown";let Un;const $r=()=>Un??(Un=(()=>{if(typeof Deno<"u"&&null!=Deno.build)return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ae,"X-Stainless-OS":Zn(Deno.build.os),"X-Stainless-Arch":Ln(Deno.build.arch),"X-Stainless-Runtime":"deno","X-Stainless-Runtime-Version":"string"==typeof Deno.version?Deno.version:Deno.version?.deno??"unknown"};if(typeof EdgeRuntime<"u")return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ae,"X-Stainless-OS":"Unknown","X-Stainless-Arch":`other:${EdgeRuntime}`,"X-Stainless-Runtime":"edge","X-Stainless-Runtime-Version":process.version};if("[object process]"===Object.prototype.toString.call(typeof process<"u"?process:0))return{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ae,"X-Stainless-OS":Zn(process.platform),"X-Stainless-Arch":Ln(process.arch),"X-Stainless-Runtime":"node","X-Stainless-Runtime-Version":process.version};const r=function Fr(){if(typeof navigator>"u"||!navigator)return null;const r=[{key:"edge",pattern:/Edge(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/MSIE(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"ie",pattern:/Trident(?:.*rv\:(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"chrome",pattern:/Chrome(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"firefox",pattern:/Firefox(?:\W+(\d+)\.(\d+)(?:\.(\d+))?)?/},{key:"safari",pattern:/(?:Version\W+(\d+)\.(\d+)(?:\.(\d+))?)?(?:\W+Mobile\S*)?\W+Safari/}];for(const{key:e,pattern:t}of r){const n=t.exec(navigator.userAgent);if(n)return{browser:e,version:`${n[1]||0}.${n[2]||0}.${n[3]||0}`}}return null}();return r?{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ae,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":`browser:${r.browser}`,"X-Stainless-Runtime-Version":r.version}:{"X-Stainless-Lang":"js","X-Stainless-Package-Version":ae,"X-Stainless-OS":"Unknown","X-Stainless-Arch":"unknown","X-Stainless-Runtime":"unknown","X-Stainless-Runtime-Version":"unknown"}})()),Br=r=>{try{return JSON.parse(r)}catch{return}},jr=new RegExp("^(?:[a-z]+:)?//","i"),Nr=r=>jr.test(r),_e=r=>new Promise(e=>setTimeout(e,r)),Zt=(r,e)=>{if("number"!=typeof e||!Number.isInteger(e))throw new y(`${r} must be an integer`);if(e<0)throw new y(`${r} must be a positive integer`);return e},Ut=r=>r instanceof Error?r:new Error(r),$e=r=>typeof process<"u"?process.env?.[r]?.trim()??void 0:typeof Deno<"u"?Deno.env?.get?.(r)?.trim():void 0;function qn(r){if(!r)return!0;for(const e in r)return!1;return!0}function Wn(r,e){return Object.prototype.hasOwnProperty.call(r,e)}function Hn(r,e){for(const t in e){if(!Wn(e,t))continue;const n=t.toLowerCase();if(!n)continue;const s=e[t];null===s?delete r[n]:void 0!==s&&(r[n]=s)}}function oe(r,...e){typeof process<"u"&&"true"===process?.env?.DEBUG&&console.log(`OpenAI:DEBUG:${r}`,...e)}const Ur=()=>"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=16*Math.random()|0;return("x"===r?e:3&e|8).toString(16)});function Xn(r){return null!=r&&"object"==typeof r&&!Array.isArray(r)}class y extends Error{}class P extends y{constructor(e,t,n,s){super(`${P.makeMessage(e,t,n)}`),this.status=e,this.headers=s,this.request_id=s?.["x-request-id"];const i=t;this.error=i,this.code=i?.code,this.param=i?.param,this.type=i?.type}static makeMessage(e,t,n){const s=t?.message?"string"==typeof t.message?t.message:JSON.stringify(t.message):t?JSON.stringify(t):n;return e&&s?`${e} ${s}`:e?`${e} status code (no body)`:s||"(no status code or body)"}static generate(e,t,n,s){if(!e)return new ye({cause:Ut(t)});const i=t?.error;return 400===e?new qt(e,i,n,s):401===e?new Wt(e,i,n,s):403===e?new Ht(e,i,n,s):404===e?new Xt(e,i,n,s):409===e?new Vt(e,i,n,s):422===e?new Jt(e,i,n,s):429===e?new Gt(e,i,n,s):e>=500?new zt(e,i,n,s):new P(e,i,n,s)}}class T extends P{constructor({message:e}={}){super(void 0,void 0,e||"Request was aborted.",void 0),this.status=void 0}}class ye extends P{constructor({message:e,cause:t}){super(void 0,void 0,e||"Connection error.",void 0),this.status=void 0,t&&(this.cause=t)}}class Be extends ye{constructor({message:e}={}){super({message:e??"Request timed out."})}}class qt extends P{constructor(){super(...arguments),this.status=400}}class Wt extends P{constructor(){super(...arguments),this.status=401}}class Ht extends P{constructor(){super(...arguments),this.status=403}}class Xt extends P{constructor(){super(...arguments),this.status=404}}class Vt extends P{constructor(){super(...arguments),this.status=409}}class Jt extends P{constructor(){super(...arguments),this.status=422}}class Gt extends P{constructor(){super(...arguments),this.status=429}}class zt extends P{}class Kt extends Dn{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[],this.object=n.object}getPaginatedItems(){return this.data??[]}nextPageParams(){return null}nextPageInfo(){return null}}class q extends Dn{constructor(e,t,n,s){super(e,t,n,s),this.data=n.data||[]}getPaginatedItems(){return this.data??[]}nextPageParams(){const e=this.nextPageInfo();if(!e)return null;if("params"in e)return e.params;const t=Object.fromEntries(e.url.searchParams);return Object.keys(t).length?t:null}nextPageInfo(){const e=this.getPaginatedItems();if(!e.length)return null;const t=e[e.length-1]?.id;return t?{params:{after:t}}:null}}class v{constructor(e){this._client=e}}class je extends v{create(e,t){return this._client.post("/completions",{body:e,...t,stream:e.stream??!1})}}je||(je={});class Ne extends v{create(e,t){return this._client.post("/chat/completions",{body:e,...t,stream:e.stream??!1})}}Ne||(Ne={});class De extends v{constructor(){super(...arguments),this.completions=new Ne(this._client)}}(De||(De={})).Completions=Ne;class Le extends v{create(e,t){return this._client.post("/embeddings",{body:e,...t})}}Le||(Le={});class Ze extends v{create(e,t){return this._client.post("/files",ge({body:e,...t}))}retrieve(e,t){return this._client.get(`/files/${e}`,t)}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/files",Qt,{query:e,...t})}del(e,t){return this._client.delete(`/files/${e}`,t)}content(e,t){return this._client.get(`/files/${e}/content`,{...t,__binaryResponse:!0})}retrieveContent(e,t){return this._client.get(`/files/${e}/content`,{...t,headers:{Accept:"application/json",...t?.headers}})}waitForProcessing(e,{pollInterval:t=5e3,maxWait:n=18e5}={}){var s=this;return(0,h.Z)(function*(){const i=new Set(["processed","error","deleted"]),a=Date.now();let o=yield s.retrieve(e);for(;!o.status||!i.has(o.status);)if(yield _e(t),o=yield s.retrieve(e),Date.now()-a>n)throw new Be({message:`Giving up on waiting for file ${e} to finish processing after ${n} milliseconds.`});return o})()}}class Qt extends Kt{}(Ze||(Ze={})).FileObjectsPage=Qt;class Ue extends v{createVariation(e,t){return this._client.post("/images/variations",ge({body:e,...t}))}edit(e,t){return this._client.post("/images/edits",ge({body:e,...t}))}generate(e,t){return this._client.post("/images/generations",{body:e,...t})}}Ue||(Ue={});class qe extends v{create(e,t){return this._client.post("/audio/speech",{body:e,...t,__binaryResponse:!0})}}qe||(qe={});class We extends v{create(e,t){return this._client.post("/audio/transcriptions",ge({body:e,...t}))}}We||(We={});class He extends v{create(e,t){return this._client.post("/audio/translations",ge({body:e,...t}))}}He||(He={});class Xe extends v{constructor(){super(...arguments),this.transcriptions=new We(this._client),this.translations=new He(this._client),this.speech=new qe(this._client)}}!function(r){r.Transcriptions=We,r.Translations=He,r.Speech=qe}(Xe||(Xe={}));class Ve extends v{create(e,t){return this._client.post("/moderations",{body:e,...t})}}Ve||(Ve={});class Je extends v{retrieve(e,t){return this._client.get(`/models/${e}`,t)}list(e){return this._client.getAPIList("/models",Yt,e)}del(e,t){return this._client.delete(`/models/${e}`,t)}}class Yt extends Kt{}!function(r){r.ModelsPage=Yt}(Je||(Je={}));class Ge extends v{list(e,t={},n){return B(t)?this.list(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/checkpoints`,en,{query:t,...n})}}class en extends q{}!function(r){r.FineTuningJobCheckpointsPage=en}(Ge||(Ge={}));class ze extends v{constructor(){super(...arguments),this.checkpoints=new Ge(this._client)}create(e,t){return this._client.post("/fine_tuning/jobs",{body:e,...t})}retrieve(e,t){return this._client.get(`/fine_tuning/jobs/${e}`,t)}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/fine_tuning/jobs",tn,{query:e,...t})}cancel(e,t){return this._client.post(`/fine_tuning/jobs/${e}/cancel`,t)}listEvents(e,t={},n){return B(t)?this.listEvents(e,{},t):this._client.getAPIList(`/fine_tuning/jobs/${e}/events`,nn,{query:t,...n})}}class tn extends q{}class nn extends q{}!function(r){r.FineTuningJobsPage=tn,r.FineTuningJobEventsPage=nn,r.Checkpoints=Ge,r.FineTuningJobCheckpointsPage=en}(ze||(ze={}));class Ke extends v{constructor(){super(...arguments),this.jobs=new ze(this._client)}}!function(r){r.Jobs=ze,r.FineTuningJobsPage=tn,r.FineTuningJobEventsPage=nn}(Ke||(Ke={}));class Qe extends v{create(e,t){return this._client.post("/assistants",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/assistants/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/assistants",rn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/assistants/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class rn extends q{}function Vn(r){return"function"==typeof r.parse}!function(r){r.AssistantsPage=rn}(Qe||(Qe={}));const le=r=>"assistant"===r?.role,Jn=r=>"function"===r?.role,Gn=r=>"tool"===r?.role;var I,Ye,et,we,be,tt,ve,Q,Ae,nt,rt,ce,sn,st,an,on,ln,cn,zn,un,W=function(r,e,t,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(r,t):s?s.value=t:e.set(r,t),t},_=function(r,e,t,n){if("a"===t&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?n:"a"===t?n.call(r):n?n.value:e.get(r)};const Kn=10;class Qn{constructor(){I.add(this),this.controller=new AbortController,Ye.set(this,void 0),et.set(this,()=>{}),we.set(this,()=>{}),be.set(this,void 0),tt.set(this,()=>{}),ve.set(this,()=>{}),Q.set(this,{}),this._chatCompletions=[],this.messages=[],Ae.set(this,!1),nt.set(this,!1),rt.set(this,!1),ce.set(this,!1),cn.set(this,e=>{if(W(this,nt,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new T),e instanceof T)return W(this,rt,!0,"f"),this._emit("abort",e);if(e instanceof y)return this._emit("error",e);if(e instanceof Error){const t=new y(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new y(String(e)))}),W(this,Ye,new Promise((e,t)=>{W(this,et,e,"f"),W(this,we,t,"f")}),"f"),W(this,be,new Promise((e,t)=>{W(this,tt,e,"f"),W(this,ve,t,"f")}),"f"),_(this,Ye,"f").catch(()=>{}),_(this,be,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emitFinal(),this._emit("end")},_(this,cn,"f"))},0)}_addChatCompletion(e){this._chatCompletions.push(e),this._emit("chatCompletion",e);const t=e.choices[0]?.message;return t&&this._addMessage(t),e}_addMessage(e,t=!0){if("content"in e||(e.content=null),this.messages.push(e),t)if(this._emit("message",e),(Jn(e)||Gn(e))&&e.content)this._emit("functionCallResult",e.content);else if(le(e)&&e.function_call)this._emit("functionCall",e.function_call);else if(le(e)&&e.tool_calls)for(const n of e.tool_calls)"function"===n.type&&this._emit("functionCall",n.function)}_connected(){this.ended||(_(this,et,"f").call(this),this._emit("connect"))}get ended(){return _(this,Ae,"f")}get errored(){return _(this,nt,"f")}get aborted(){return _(this,rt,"f")}abort(){this.controller.abort()}on(e,t){return(_(this,Q,"f")[e]||(_(this,Q,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=_(this,Q,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(_(this,Q,"f")[e]||(_(this,Q,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{W(this,ce,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)})}done(){var e=this;return(0,h.Z)(function*(){W(e,ce,!0,"f"),yield _(e,be,"f")})()}finalChatCompletion(){var e=this;return(0,h.Z)(function*(){yield e.done();const t=e._chatCompletions[e._chatCompletions.length-1];if(!t)throw new y("stream ended without producing a ChatCompletion");return t})()}finalContent(){var e=this;return(0,h.Z)(function*(){return yield e.done(),_(e,I,"m",sn).call(e)})()}finalMessage(){var e=this;return(0,h.Z)(function*(){return yield e.done(),_(e,I,"m",st).call(e)})()}finalFunctionCall(){var e=this;return(0,h.Z)(function*(){return yield e.done(),_(e,I,"m",an).call(e)})()}finalFunctionCallResult(){var e=this;return(0,h.Z)(function*(){return yield e.done(),_(e,I,"m",on).call(e)})()}totalUsage(){var e=this;return(0,h.Z)(function*(){return yield e.done(),_(e,I,"m",ln).call(e)})()}allChatCompletions(){return[...this._chatCompletions]}_emit(e,...t){if(_(this,Ae,"f"))return;"end"===e&&(W(this,Ae,!0,"f"),_(this,tt,"f").call(this));const n=_(this,Q,"f")[e];if(n&&(_(this,Q,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),"abort"===e){const s=t[0];return!_(this,ce,"f")&&!n?.length&&Promise.reject(s),_(this,we,"f").call(this,s),_(this,ve,"f").call(this,s),void this._emit("end")}if("error"===e){const s=t[0];!_(this,ce,"f")&&!n?.length&&Promise.reject(s),_(this,we,"f").call(this,s),_(this,ve,"f").call(this,s),this._emit("end")}}_emitFinal(){const e=this._chatCompletions[this._chatCompletions.length-1];e&&this._emit("finalChatCompletion",e);const t=_(this,I,"m",st).call(this);t&&this._emit("finalMessage",t);const n=_(this,I,"m",sn).call(this);n&&this._emit("finalContent",n);const s=_(this,I,"m",an).call(this);s&&this._emit("finalFunctionCall",s);const i=_(this,I,"m",on).call(this);null!=i&&this._emit("finalFunctionCallResult",i),this._chatCompletions.some(a=>a.usage)&&this._emit("totalUsage",_(this,I,"m",ln).call(this))}_createChatCompletion(e,t,n){var s=this;return(0,h.Z)(function*(){const i=n?.signal;i&&(i.aborted&&s.controller.abort(),i.addEventListener("abort",()=>s.controller.abort())),_(s,I,"m",zn).call(s,t);const a=yield e.create({...t,stream:!1},{...n,signal:s.controller.signal});return s._connected(),s._addChatCompletion(a)})()}_runChatCompletion(e,t,n){var s=this;return(0,h.Z)(function*(){for(const i of t.messages)s._addMessage(i,!1);return yield s._createChatCompletion(e,t,n)})()}_runFunctions(e,t,n){var s=this;return(0,h.Z)(function*(){const i="function",{function_call:a="auto",stream:o,...l}=t,c="string"!=typeof a&&a?.name,{maxChatCompletions:u=Kn}=n||{},p={};for(const d of t.functions)p[d.name||d.function.name]=d;const f=t.functions.map(d=>({name:d.name||d.function.name,parameters:d.parameters,description:d.description}));for(const d of t.messages)s._addMessage(d,!1);for(let d=0;d<u;++d){const A=(yield s._createChatCompletion(e,{...l,function_call:a,functions:f,messages:[...s.messages]},n)).choices[0]?.message;if(!A)throw new y("missing message in ChatCompletion response");if(!A.function_call)return;const{name:b,arguments:O}=A.function_call,E=p[b];if(!E){const F=`Invalid function_call: ${JSON.stringify(b)}. Available options are: ${f.map(Z=>JSON.stringify(Z.name)).join(", ")}. Please try again`;s._addMessage({role:i,name:b,content:F});continue}if(c&&c!==b){const F=`Invalid function_call: ${JSON.stringify(b)}. ${JSON.stringify(c)} requested. Please try again`;s._addMessage({role:i,name:b,content:F});continue}let ee;try{ee=Vn(E)?yield E.parse(O):O}catch(F){s._addMessage({role:i,name:b,content:F instanceof Error?F.message:String(F)});continue}const k=yield E.function(ee,s),L=_(s,I,"m",un).call(s,k);if(s._addMessage({role:i,name:b,content:L}),c)return}})()}_runTools(e,t,n){var s=this;return(0,h.Z)(function*(){const i="tool",{tool_choice:a="auto",stream:o,...l}=t,c="string"!=typeof a&&a?.function?.name,{maxChatCompletions:u=Kn}=n||{},p={};for(const d of t.tools)"function"===d.type&&(p[d.function.name||d.function.function.name]=d.function);const f="tools"in t?t.tools.map(d=>"function"===d.type?{type:"function",function:{name:d.function.name||d.function.function.name,parameters:d.function.parameters,description:d.function.description}}:d):void 0;for(const d of t.messages)s._addMessage(d,!1);for(let d=0;d<u;++d){const A=(yield s._createChatCompletion(e,{...l,tool_choice:a,tools:f,messages:[...s.messages]},n)).choices[0]?.message;if(!A)throw new y("missing message in ChatCompletion response");if(!A.tool_calls)return;for(const b of A.tool_calls){if("function"!==b.type)continue;const O=b.id,{name:E,arguments:ee}=b.function,k=p[E];if(!k){const U=`Invalid tool_call: ${JSON.stringify(E)}. Available options are: ${f.map(D=>JSON.stringify(D.function.name)).join(", ")}. Please try again`;s._addMessage({role:i,tool_call_id:O,content:U});continue}if(c&&c!==E){const U=`Invalid tool_call: ${JSON.stringify(E)}. ${JSON.stringify(c)} requested. Please try again`;s._addMessage({role:i,tool_call_id:O,content:U});continue}let L;try{L=Vn(k)?yield k.parse(ee):ee}catch(U){const D=U instanceof Error?U.message:String(U);s._addMessage({role:i,tool_call_id:O,content:D});continue}const F=yield k.function(L,s),Z=_(s,I,"m",un).call(s,F);if(s._addMessage({role:i,tool_call_id:O,content:Z}),c)return}}})()}}Ye=new WeakMap,et=new WeakMap,we=new WeakMap,be=new WeakMap,tt=new WeakMap,ve=new WeakMap,Q=new WeakMap,Ae=new WeakMap,nt=new WeakMap,rt=new WeakMap,ce=new WeakMap,cn=new WeakMap,I=new WeakSet,sn=function(){return _(this,I,"m",st).call(this).content??null},st=function(){let e=this.messages.length;for(;e-- >0;){const t=this.messages[e];if(le(t)){const{function_call:n,...s}=t,i={...s,content:t.content??null};return n&&(i.function_call=n),i}}throw new y("stream ended without producing a ChatCompletionMessage with role=assistant")},an=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(le(t)&&t?.function_call)return t.function_call;if(le(t)&&t?.tool_calls?.length)return t.tool_calls.at(-1)?.function}},on=function(){for(let e=this.messages.length-1;e>=0;e--){const t=this.messages[e];if(Jn(t)&&null!=t.content||Gn(t)&&null!=t.content&&this.messages.some(n=>"assistant"===n.role&&n.tool_calls?.some(s=>"function"===s.type&&s.id===t.tool_call_id)))return t.content}},ln=function(){const e={completion_tokens:0,prompt_tokens:0,total_tokens:0};for(const{usage:t}of this._chatCompletions)t&&(e.completion_tokens+=t.completion_tokens,e.prompt_tokens+=t.prompt_tokens,e.total_tokens+=t.total_tokens);return e},zn=function(e){if(null!=e.n&&e.n>1)throw new y("ChatCompletion convenience helpers only support n=1 at this time. To use n>1, please use chat.completions.create() directly.")},un=function(e){return"string"==typeof e?e:void 0===e?"undefined":JSON.stringify(e)};class Ce extends Qn{static runFunctions(e,t,n){const s=new Ce,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){const s=new Ce,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}_addMessage(e){super._addMessage(e),le(e)&&e.content&&this._emit("content",e.content)}}var z,re,hn,fn,it,Yn,H=function(r,e,t,n){if("a"===t&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?n:"a"===t?n.call(r):n?n.value:e.get(r)},dn=function(r,e,t,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(r,t):s?s.value=t:e.set(r,t),t};class Se extends Qn{constructor(){super(...arguments),z.add(this),re.set(this,void 0)}get currentChatCompletionSnapshot(){return H(this,re,"f")}static fromReadableStream(e){const t=new Se;return t._run(()=>t._fromReadableStream(e)),t}static createChatCompletion(e,t,n){const s=new Se;return s._run(()=>s._runChatCompletion(e,{...t,stream:!0},{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}_createChatCompletion(e,t,n){var s=this;return(0,h.Z)(function*(){const i=n?.signal;i&&(i.aborted&&s.controller.abort(),i.addEventListener("abort",()=>s.controller.abort())),H(s,z,"m",hn).call(s);const a=yield e.create({...t,stream:!0},{...n,signal:s.controller.signal});s._connected();var c,o=!1,l=!1;try{for(var p,u=M(a);o=!(p=yield u.next()).done;o=!1){const f=p.value;H(s,z,"m",fn).call(s,f)}}catch(f){l=!0,c=f}finally{try{o&&null!=u.return&&(yield u.return())}finally{if(l)throw c}}if(a.controller.signal?.aborted)throw new T;return s._addChatCompletion(H(s,z,"m",it).call(s))})()}_fromReadableStream(e,t){var n=this;return(0,h.Z)(function*(){const s=t?.signal;s&&(s.aborted&&n.controller.abort(),s.addEventListener("abort",()=>n.controller.abort())),H(n,z,"m",hn).call(n),n._connected();const i=G.fromReadableStream(e,n.controller);let a;var c,o=!1,l=!1;try{for(var p,u=M(i);o=!(p=yield u.next()).done;o=!1){const f=p.value;a&&a!==f.id&&n._addChatCompletion(H(n,z,"m",it).call(n)),H(n,z,"m",fn).call(n,f),a=f.id}}catch(f){l=!0,c=f}finally{try{o&&null!=u.return&&(yield u.return())}finally{if(l)throw c}}if(i.controller.signal?.aborted)throw new T;return n._addChatCompletion(H(n,z,"m",it).call(n))})()}[(re=new WeakMap,z=new WeakSet,hn=function(){this.ended||dn(this,re,void 0,"f")},fn=function(t){if(this.ended)return;const n=H(this,z,"m",Yn).call(this,t);this._emit("chunk",t,n);const s=t.choices[0]?.delta?.content,i=n.choices[0]?.message;null!=s&&"assistant"===i?.role&&i?.content&&this._emit("content",s,i.content)},it=function(){if(this.ended)throw new y("stream has ended, this shouldn't happen");const t=H(this,re,"f");if(!t)throw new y("request ended without sending any chunks");return dn(this,re,void 0,"f"),function Hr(r){const{id:e,choices:t,created:n,model:s,system_fingerprint:i,...a}=r;return{...a,id:e,choices:t.map(({message:o,finish_reason:l,index:c,logprobs:u,...p})=>{if(!l)throw new y(`missing finish_reason for choice ${c}`);const{content:f=null,function_call:d,tool_calls:g,...A}=o,b=o.role;if(!b)throw new y(`missing role for choice ${c}`);if(d){const{arguments:O,name:E}=d;if(null==O)throw new y(`missing function_call.arguments for choice ${c}`);if(!E)throw new y(`missing function_call.name for choice ${c}`);return{...p,message:{content:f,function_call:{arguments:O,name:E},role:b},finish_reason:l,index:c,logprobs:u}}return g?{...p,index:c,finish_reason:l,logprobs:u,message:{...A,role:b,content:f,tool_calls:g.map((O,E)=>{const{function:ee,type:k,id:L,...F}=O,{arguments:Z,name:U,...D}=ee||{};if(null==L)throw new y(`missing choices[${c}].tool_calls[${E}].id\n${at(r)}`);if(null==k)throw new y(`missing choices[${c}].tool_calls[${E}].type\n${at(r)}`);if(null==U)throw new y(`missing choices[${c}].tool_calls[${E}].function.name\n${at(r)}`);if(null==Z)throw new y(`missing choices[${c}].tool_calls[${E}].function.arguments\n${at(r)}`);return{...F,id:L,type:k,function:{...D,name:U,arguments:Z}}})}}:{...p,message:{...A,content:f,role:b},finish_reason:l,index:c,logprobs:u}}),created:n,model:s,object:"chat.completion",...i?{system_fingerprint:i}:{}}}(t)},Yn=function(t){var n,s,i;let a=H(this,re,"f");const{choices:o,...l}=t;a?Object.assign(a,l):a=dn(this,re,{...l,choices:[]},"f");for(const{delta:c,finish_reason:u,index:p,logprobs:f=null,...d}of t.choices){let g=a.choices[p];if(g||(g=a.choices[p]={finish_reason:u,index:p,message:{},logprobs:f,...d}),f)if(g.logprobs){const{content:k,...L}=f;Object.assign(g.logprobs,L),k&&((n=g.logprobs).content??(n.content=[]),g.logprobs.content.push(...k))}else g.logprobs=Object.assign({},f);if(u&&(g.finish_reason=u),Object.assign(g,d),!c)continue;const{content:A,function_call:b,role:O,tool_calls:E,...ee}=c;if(Object.assign(g.message,ee),A&&(g.message.content=(g.message.content||"")+A),O&&(g.message.role=O),b&&(g.message.function_call?(b.name&&(g.message.function_call.name=b.name),b.arguments&&((s=g.message.function_call).arguments??(s.arguments=""),g.message.function_call.arguments+=b.arguments)):g.message.function_call=b),E){g.message.tool_calls||(g.message.tool_calls=[]);for(const{index:k,id:L,type:F,function:Z,...U}of E){const D=(i=g.message.tool_calls)[k]??(i[k]={});Object.assign(D,U),L&&(D.id=L),F&&(D.type=F),Z&&(D.function??(D.function={arguments:""})),Z?.name&&(D.function.name=Z.name),Z?.arguments&&(D.function.arguments+=Z.arguments)}}}return a},Symbol.asyncIterator)](){var e=this;const t=[],n=[];let s=!1;return this.on("chunk",i=>{const a=n.shift();a?a.resolve(i):t.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const a of n)a.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const a of n)a.reject(i);n.length=0}),{next:(i=(0,h.Z)(function*(){return t.length?{value:t.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((o,l)=>n.push({resolve:o,reject:l})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0})}),function(){return i.apply(this,arguments)}),return:function(){var i=(0,h.Z)(function*(){return e.abort(),{value:void 0,done:!0}});return function(){return i.apply(this,arguments)}}()};var i}toReadableStream(){return new G(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}}function at(r){return JSON.stringify(r)}class ue extends Se{static fromReadableStream(e){const t=new ue;return t._run(()=>t._fromReadableStream(e)),t}static runFunctions(e,t,n){const s=new ue,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runFunctions"}};return s._run(()=>s._runFunctions(e,t,i)),s}static runTools(e,t,n){const s=new ue,i={...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"runTools"}};return s._run(()=>s._runTools(e,t,i)),s}}class er extends v{runFunctions(e,t){return e.stream?ue.runFunctions(this._client.chat.completions,e,t):Ce.runFunctions(this._client.chat.completions,e,t)}runTools(e,t){return e.stream?ue.runTools(this._client.chat.completions,e,t):Ce.runTools(this._client.chat.completions,e,t)}stream(e,t){return Se.createChatCompletion(this._client.chat.completions,e,t)}}class ot extends v{constructor(){super(...arguments),this.completions=new er(this._client)}}!function(r){r.Completions=er}(ot||(ot={}));var lt,ct,Ee,Pe,ut,xe,Y,Re,dt,ht,de,pn,X=function(r,e,t,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(r,t):s?s.value=t:e.set(r,t),t},C=function(r,e,t,n){if("a"===t&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?n:"a"===t?n.call(r):n?n.value:e.get(r)};class Xr{constructor(){this.controller=new AbortController,lt.set(this,void 0),ct.set(this,()=>{}),Ee.set(this,()=>{}),Pe.set(this,void 0),ut.set(this,()=>{}),xe.set(this,()=>{}),Y.set(this,{}),Re.set(this,!1),dt.set(this,!1),ht.set(this,!1),de.set(this,!1),pn.set(this,e=>{if(X(this,dt,!0,"f"),e instanceof Error&&"AbortError"===e.name&&(e=new T),e instanceof T)return X(this,ht,!0,"f"),this._emit("abort",e);if(e instanceof y)return this._emit("error",e);if(e instanceof Error){const t=new y(e.message);return t.cause=e,this._emit("error",t)}return this._emit("error",new y(String(e)))}),X(this,lt,new Promise((e,t)=>{X(this,ct,e,"f"),X(this,Ee,t,"f")}),"f"),X(this,Pe,new Promise((e,t)=>{X(this,ut,e,"f"),X(this,xe,t,"f")}),"f"),C(this,lt,"f").catch(()=>{}),C(this,Pe,"f").catch(()=>{})}_run(e){setTimeout(()=>{e().then(()=>{this._emit("end")},C(this,pn,"f"))},0)}_addRun(e){return e}_connected(){this.ended||(C(this,ct,"f").call(this),this._emit("connect"))}get ended(){return C(this,Re,"f")}get errored(){return C(this,dt,"f")}get aborted(){return C(this,ht,"f")}abort(){this.controller.abort()}on(e,t){return(C(this,Y,"f")[e]||(C(this,Y,"f")[e]=[])).push({listener:t}),this}off(e,t){const n=C(this,Y,"f")[e];if(!n)return this;const s=n.findIndex(i=>i.listener===t);return s>=0&&n.splice(s,1),this}once(e,t){return(C(this,Y,"f")[e]||(C(this,Y,"f")[e]=[])).push({listener:t,once:!0}),this}emitted(e){return new Promise((t,n)=>{X(this,de,!0,"f"),"error"!==e&&this.once("error",n),this.once(e,t)})}done(){var e=this;return(0,h.Z)(function*(){X(e,de,!0,"f"),yield C(e,Pe,"f")})()}_emit(e,...t){if(C(this,Re,"f"))return;"end"===e&&(X(this,Re,!0,"f"),C(this,ut,"f").call(this));const n=C(this,Y,"f")[e];if(n&&(C(this,Y,"f")[e]=n.filter(s=>!s.once),n.forEach(({listener:s})=>s(...t))),"abort"===e){const s=t[0];return!C(this,de,"f")&&!n?.length&&Promise.reject(s),C(this,Ee,"f").call(this,s),C(this,xe,"f").call(this,s),void this._emit("end")}if("error"===e){const s=t[0];!C(this,de,"f")&&!n?.length&&Promise.reject(s),C(this,Ee,"f").call(this,s),C(this,xe,"f").call(this,s),this._emit("end")}}_threadAssistantStream(e,t,n){var s=this;return(0,h.Z)(function*(){return yield s._createThreadAssistantStream(t,e,n)})()}_runAssistantStream(e,t,n,s){var i=this;return(0,h.Z)(function*(){return yield i._createAssistantStream(t,e,n,s)})()}_runToolAssistantStream(e,t,n,s,i){var a=this;return(0,h.Z)(function*(){return yield a._createToolAssistantStream(n,e,t,s,i)})()}_createThreadAssistantStream(e,t,n){var s=this;return(0,h.Z)(function*(){const i=n?.signal;i&&(i.aborted&&s.controller.abort(),i.addEventListener("abort",()=>s.controller.abort()));const a=yield e.createAndRun({...t,stream:!1},{...n,signal:s.controller.signal});return s._connected(),s._addRun(a)})()}_createToolAssistantStream(e,t,n,s,i){var a=this;return(0,h.Z)(function*(){const o=i?.signal;o&&(o.aborted&&a.controller.abort(),o.addEventListener("abort",()=>a.controller.abort()));const l=yield e.submitToolOutputs(t,n,{...s,stream:!1},{...i,signal:a.controller.signal});return a._connected(),a._addRun(l)})()}_createAssistantStream(e,t,n,s){var i=this;return(0,h.Z)(function*(){const a=s?.signal;a&&(a.aborted&&i.controller.abort(),a.addEventListener("abort",()=>i.controller.abort()));const o=yield e.create(t,{...n,stream:!1},{...s,signal:i.controller.signal});return i._connected(),i._addRun(o)})()}}lt=new WeakMap,ct=new WeakMap,Ee=new WeakMap,Pe=new WeakMap,ut=new WeakMap,xe=new WeakMap,Y=new WeakMap,Re=new WeakMap,dt=new WeakMap,ht=new WeakMap,de=new WeakMap,pn=new WeakMap;var x,mn,K,ft,V,se,he,ie,pt,N,mt,gt,Ie,Oe,ke,tr,nr,rr,sr,ir,ar,or,m=function(r,e,t,n){if("a"===t&&!n)throw new TypeError("Private accessor was defined without a getter");if("function"==typeof e?r!==e||!n:!e.has(r))throw new TypeError("Cannot read private member from an object whose class did not declare it");return"m"===t?n:"a"===t?n.call(r):n?n.value:e.get(r)},j=function(r,e,t,n,s){if("m"===n)throw new TypeError("Private method is not writable");if("a"===n&&!s)throw new TypeError("Private accessor was defined without a setter");if("function"==typeof e?r!==e||!s:!e.has(r))throw new TypeError("Cannot write private member to an object whose class did not declare it");return"a"===n?s.call(r,t):s?s.value=t:e.set(r,t),t};class J extends Xr{constructor(){super(...arguments),x.add(this),mn.set(this,[]),K.set(this,{}),ft.set(this,{}),V.set(this,void 0),se.set(this,void 0),he.set(this,void 0),ie.set(this,void 0),pt.set(this,void 0),N.set(this,void 0),mt.set(this,void 0),gt.set(this,void 0),Ie.set(this,void 0)}[(mn=new WeakMap,K=new WeakMap,ft=new WeakMap,V=new WeakMap,se=new WeakMap,he=new WeakMap,ie=new WeakMap,pt=new WeakMap,N=new WeakMap,mt=new WeakMap,gt=new WeakMap,Ie=new WeakMap,x=new WeakSet,Symbol.asyncIterator)](){var e=this;const t=[],n=[];let s=!1;return this.on("event",i=>{const a=n.shift();a?a.resolve(i):t.push(i)}),this.on("end",()=>{s=!0;for(const i of n)i.resolve(void 0);n.length=0}),this.on("abort",i=>{s=!0;for(const a of n)a.reject(i);n.length=0}),this.on("error",i=>{s=!0;for(const a of n)a.reject(i);n.length=0}),{next:(i=(0,h.Z)(function*(){return t.length?{value:t.shift(),done:!1}:s?{value:void 0,done:!0}:new Promise((o,l)=>n.push({resolve:o,reject:l})).then(o=>o?{value:o,done:!1}:{value:void 0,done:!0})}),function(){return i.apply(this,arguments)}),return:function(){var i=(0,h.Z)(function*(){return e.abort(),{value:void 0,done:!0}});return function(){return i.apply(this,arguments)}}()};var i}static fromReadableStream(e){const t=new J;return t._run(()=>t._fromReadableStream(e)),t}_fromReadableStream(e,t){var n=this;return(0,h.Z)(function*(){const s=t?.signal;s&&(s.aborted&&n.controller.abort(),s.addEventListener("abort",()=>n.controller.abort())),n._connected();const i=G.fromReadableStream(e,n.controller);var l,a=!1,o=!1;try{for(var u,c=M(i);a=!(u=yield c.next()).done;a=!1){const p=u.value;m(n,x,"m",Oe).call(n,p)}}catch(p){o=!0,l=p}finally{try{a&&null!=c.return&&(yield c.return())}finally{if(o)throw l}}if(i.controller.signal?.aborted)throw new T;return n._addRun(m(n,x,"m",ke).call(n))})()}toReadableStream(){return new G(this[Symbol.asyncIterator].bind(this),this.controller).toReadableStream()}static createToolAssistantStream(e,t,n,s,i){const a=new J;return a._run(()=>a._runToolAssistantStream(e,t,n,s,{...i,headers:{...i?.headers,"X-Stainless-Helper-Method":"stream"}})),a}_createToolAssistantStream(e,t,n,s,i){var a=this;return(0,h.Z)(function*(){const o=i?.signal;o&&(o.aborted&&a.controller.abort(),o.addEventListener("abort",()=>a.controller.abort()));const l={...s,stream:!0},c=yield e.submitToolOutputs(t,n,l,{...i,signal:a.controller.signal});a._connected();var f,u=!1,p=!1;try{for(var g,d=M(c);u=!(g=yield d.next()).done;u=!1){const A=g.value;m(a,x,"m",Oe).call(a,A)}}catch(A){p=!0,f=A}finally{try{u&&null!=d.return&&(yield d.return())}finally{if(p)throw f}}if(c.controller.signal?.aborted)throw new T;return a._addRun(m(a,x,"m",ke).call(a))})()}static createThreadAssistantStream(e,t,n){const s=new J;return s._run(()=>s._threadAssistantStream(e,t,{...n,headers:{...n?.headers,"X-Stainless-Helper-Method":"stream"}})),s}static createAssistantStream(e,t,n,s){const i=new J;return i._run(()=>i._runAssistantStream(e,t,n,{...s,headers:{...s?.headers,"X-Stainless-Helper-Method":"stream"}})),i}currentEvent(){return m(this,mt,"f")}currentRun(){return m(this,gt,"f")}currentMessageSnapshot(){return m(this,V,"f")}currentRunStepSnapshot(){return m(this,Ie,"f")}finalRunSteps(){var e=this;return(0,h.Z)(function*(){return yield e.done(),Object.values(m(e,K,"f"))})()}finalMessages(){var e=this;return(0,h.Z)(function*(){return yield e.done(),Object.values(m(e,ft,"f"))})()}finalRun(){var e=this;return(0,h.Z)(function*(){if(yield e.done(),!m(e,se,"f"))throw Error("Final run was not received.");return m(e,se,"f")})()}_createThreadAssistantStream(e,t,n){var s=this;return(0,h.Z)(function*(){const i=n?.signal;i&&(i.aborted&&s.controller.abort(),i.addEventListener("abort",()=>s.controller.abort()));const a={...t,stream:!0},o=yield e.createAndRun(a,{...n,signal:s.controller.signal});s._connected();var u,l=!1,c=!1;try{for(var f,p=M(o);l=!(f=yield p.next()).done;l=!1){const d=f.value;m(s,x,"m",Oe).call(s,d)}}catch(d){c=!0,u=d}finally{try{l&&null!=p.return&&(yield p.return())}finally{if(c)throw u}}if(o.controller.signal?.aborted)throw new T;return s._addRun(m(s,x,"m",ke).call(s))})()}_createAssistantStream(e,t,n,s){var i=this;return(0,h.Z)(function*(){const a=s?.signal;a&&(a.aborted&&i.controller.abort(),a.addEventListener("abort",()=>i.controller.abort()));const o={...n,stream:!0},l=yield e.create(t,o,{...s,signal:i.controller.signal});i._connected();var p,c=!1,u=!1;try{for(var d,f=M(l);c=!(d=yield f.next()).done;c=!1){const g=d.value;m(i,x,"m",Oe).call(i,g)}}catch(g){u=!0,p=g}finally{try{c&&null!=f.return&&(yield f.return())}finally{if(u)throw p}}if(l.controller.signal?.aborted)throw new T;return i._addRun(m(i,x,"m",ke).call(i))})()}static accumulateDelta(e,t){for(const[n,s]of Object.entries(t)){if(!e.hasOwnProperty(n)){e[n]=s;continue}let i=e[n];if(null!=i)if("index"!==n&&"type"!==n){if("string"==typeof i&&"string"==typeof s)i+=s;else if("number"==typeof i&&"number"==typeof s)i+=s;else if(Xn(i)&&Xn(s))i=this.accumulateDelta(i,s);else{if(!Array.isArray(i)||!Array.isArray(s))throw Error(`Unhandled record type: ${n}, deltaValue: ${s}, accValue: ${i}`);if(i.every(a=>"string"==typeof a||"number"==typeof a)){i.push(...s);continue}}e[n]=i}else e[n]=s;else e[n]=s}return e}}Oe=function(e){if(!this.ended)switch(j(this,mt,e,"f"),m(this,x,"m",rr).call(this,e),e.event){case"thread.created":break;case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.requires_action":case"thread.run.completed":case"thread.run.failed":case"thread.run.cancelling":case"thread.run.cancelled":case"thread.run.expired":m(this,x,"m",or).call(this,e);break;case"thread.run.step.created":case"thread.run.step.in_progress":case"thread.run.step.delta":case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":m(this,x,"m",nr).call(this,e);break;case"thread.message.created":case"thread.message.in_progress":case"thread.message.delta":case"thread.message.completed":case"thread.message.incomplete":m(this,x,"m",tr).call(this,e);break;case"error":throw new Error("Encountered an error event in event processing - errors should be processed earlier")}},ke=function(){if(this.ended)throw new y("stream has ended, this shouldn't happen");if(!m(this,se,"f"))throw Error("Final run has not been received");return m(this,se,"f")},tr=function(e){const[t,n]=m(this,x,"m",ir).call(this,e,m(this,V,"f"));j(this,V,t,"f"),m(this,ft,"f")[t.id]=t;for(const s of n){const i=t.content[s.index];"text"==i?.type&&this._emit("textCreated",i.text)}switch(e.event){case"thread.message.created":this._emit("messageCreated",e.data);break;case"thread.message.in_progress":break;case"thread.message.delta":if(this._emit("messageDelta",e.data.delta,t),e.data.delta.content)for(const s of e.data.delta.content){if("text"==s.type&&s.text){let i=s.text,a=t.content[s.index];if(!a||"text"!=a.type)throw Error("The snapshot associated with this text delta is not text or missing");this._emit("textDelta",i,a.text)}if(s.index!=m(this,he,"f")){if(m(this,ie,"f"))switch(m(this,ie,"f").type){case"text":this._emit("textDone",m(this,ie,"f").text,m(this,V,"f"));break;case"image_file":this._emit("imageFileDone",m(this,ie,"f").image_file,m(this,V,"f"))}j(this,he,s.index,"f")}j(this,ie,t.content[s.index],"f")}break;case"thread.message.completed":case"thread.message.incomplete":if(void 0!==m(this,he,"f")){const s=e.data.content[m(this,he,"f")];if(s)switch(s.type){case"image_file":this._emit("imageFileDone",s.image_file,m(this,V,"f"));break;case"text":this._emit("textDone",s.text,m(this,V,"f"))}}m(this,V,"f")&&this._emit("messageDone",e.data),j(this,V,void 0,"f")}},nr=function(e){const t=m(this,x,"m",sr).call(this,e);switch(j(this,Ie,t,"f"),e.event){case"thread.run.step.created":this._emit("runStepCreated",e.data);break;case"thread.run.step.delta":const n=e.data.delta;if(n.step_details&&"tool_calls"==n.step_details.type&&n.step_details.tool_calls&&"tool_calls"==t.step_details.type)for(const i of n.step_details.tool_calls)i.index==m(this,pt,"f")?this._emit("toolCallDelta",i,t.step_details.tool_calls[i.index]):(m(this,N,"f")&&this._emit("toolCallDone",m(this,N,"f")),j(this,pt,i.index,"f"),j(this,N,t.step_details.tool_calls[i.index],"f"),m(this,N,"f")&&this._emit("toolCallCreated",m(this,N,"f")));this._emit("runStepDelta",e.data.delta,t);break;case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":j(this,Ie,void 0,"f"),"tool_calls"==e.data.step_details.type&&m(this,N,"f")&&(this._emit("toolCallDone",m(this,N,"f")),j(this,N,void 0,"f")),this._emit("runStepDone",e.data,t)}},rr=function(e){m(this,mn,"f").push(e),this._emit("event",e)},sr=function(e){switch(e.event){case"thread.run.step.created":return m(this,K,"f")[e.data.id]=e.data,e.data;case"thread.run.step.delta":let t=m(this,K,"f")[e.data.id];if(!t)throw Error("Received a RunStepDelta before creation of a snapshot");let n=e.data;if(n.delta){const s=J.accumulateDelta(t,n.delta);m(this,K,"f")[e.data.id]=s}return m(this,K,"f")[e.data.id];case"thread.run.step.completed":case"thread.run.step.failed":case"thread.run.step.cancelled":case"thread.run.step.expired":case"thread.run.step.in_progress":m(this,K,"f")[e.data.id]=e.data}if(m(this,K,"f")[e.data.id])return m(this,K,"f")[e.data.id];throw new Error("No snapshot available")},ir=function(e,t){let n=[];switch(e.event){case"thread.message.created":return[e.data,n];case"thread.message.delta":if(!t)throw Error("Received a delta with no existing snapshot (there should be one from message creation)");let s=e.data;if(s.delta.content)for(const i of s.delta.content)if(i.index in t.content){let a=t.content[i.index];t.content[i.index]=m(this,x,"m",ar).call(this,i,a)}else t.content[i.index]=i,n.push(i);return[t,n];case"thread.message.in_progress":case"thread.message.completed":case"thread.message.incomplete":if(t)return[t,n];throw Error("Received thread message event with no existing snapshot")}throw Error("Tried to accumulate a non-message event")},ar=function(e,t){return J.accumulateDelta(t,e)},or=function(e){switch(j(this,gt,e.data,"f"),e.event){case"thread.run.created":case"thread.run.queued":case"thread.run.in_progress":case"thread.run.cancelling":break;case"thread.run.requires_action":case"thread.run.cancelled":case"thread.run.failed":case"thread.run.completed":case"thread.run.expired":j(this,se,e.data,"f"),m(this,N,"f")&&(this._emit("toolCallDone",m(this,N,"f")),j(this,N,void 0,"f"))}};class _t extends v{create(e,t,n){return this._client.post(`/threads/${e}/messages`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/messages/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},n){return B(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/messages`,gn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/threads/${e}/messages/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}}class gn extends q{}!function(r){r.MessagesPage=gn}(_t||(_t={}));class yt extends v{retrieve(e,t,n,s){return this._client.get(`/threads/${e}/runs/${t}/steps/${n}`,{...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t,n={},s){return B(n)?this.list(e,t,{},n):this._client.getAPIList(`/threads/${e}/runs/${t}/steps`,_n,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}}class _n extends q{}!function(r){r.RunStepsPage=_n}(yt||(yt={}));class wt extends v{constructor(){super(...arguments),this.steps=new yt(this._client)}create(e,t,n){return this._client.post(`/threads/${e}/runs`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers},stream:t.stream??!1})}retrieve(e,t,n){return this._client.get(`/threads/${e}/runs/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}update(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}list(e,t={},n){return B(t)?this.list(e,{},t):this._client.getAPIList(`/threads/${e}/runs`,yn,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/threads/${e}/runs/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}createAndPoll(e,t,n){var s=this;return(0,h.Z)(function*(){const i=yield s.create(e,t,n);return yield s.poll(e,i.id,n)})()}createAndStream(e,t,n){return J.createAssistantStream(e,this._client.beta.threads.runs,t,n)}poll(e,t,n){var s=this;return(0,h.Z)(function*(){const i={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:o}=yield s.retrieve(e,t,{...n,headers:{...n?.headers,...i}}).withResponse();switch(a.status){case"queued":case"in_progress":case"cancelling":let l=5e3;if(n?.pollIntervalMs)l=n.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(l=u)}}yield _e(l);break;case"requires_action":case"incomplete":case"cancelled":case"completed":case"failed":case"expired":return a}}})()}stream(e,t,n){return J.createAssistantStream(e,this._client.beta.threads.runs,t,n)}submitToolOutputs(e,t,n,s){return this._client.post(`/threads/${e}/runs/${t}/submit_tool_outputs`,{body:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers},stream:n.stream??!1})}submitToolOutputsAndPoll(e,t,n,s){var i=this;return(0,h.Z)(function*(){const a=yield i.submitToolOutputs(e,t,n,s);return yield i.poll(e,a.id,s)})()}submitToolOutputsStream(e,t,n,s){return J.createToolAssistantStream(e,t,this._client.beta.threads.runs,n,s)}}class yn extends q{}!function(r){r.RunsPage=yn,r.Steps=yt,r.RunStepsPage=_n}(wt||(wt={}));class bt extends v{constructor(){super(...arguments),this.runs=new wt(this._client),this.messages=new _t(this._client)}create(e={},t){return B(e)?this.create({},e):this._client.post("/threads",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/threads/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t){return this._client.delete(`/threads/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}createAndRun(e,t){return this._client.post("/threads/runs",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers},stream:e.stream??!1})}createAndRunPoll(e,t){var n=this;return(0,h.Z)(function*(){const s=yield n.createAndRun(e,t);return yield n.runs.poll(s.thread_id,s.id,t)})()}createAndRunStream(e,t){return J.createThreadAssistantStream(e,this._client.beta.threads,t)}}!function(r){r.Runs=wt,r.RunsPage=yn,r.Messages=_t,r.MessagesPage=gn}(bt||(bt={}));const Vr=function(){var r=(0,h.Z)(function*(e){const t=yield Promise.allSettled(e),n=t.filter(i=>"rejected"===i.status);if(n.length){for(const i of n)console.error(i.reason);throw new Error(`${n.length} promise(s) failed - see the above errors`)}const s=[];for(const i of t)"fulfilled"===i.status&&s.push(i.value);return s});return function(t){return r.apply(this,arguments)}}();class vt extends v{create(e,t,n){return this._client.post(`/vector_stores/${e}/files`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e,t={},n){return B(t)?this.list(e,{},t):this._client.getAPIList(`/vector_stores/${e}/files`,At,{query:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}del(e,t,n){return this._client.delete(`/vector_stores/${e}/files/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}createAndPoll(e,t,n){var s=this;return(0,h.Z)(function*(){const i=yield s.create(e,t,n);return yield s.poll(e,i.id,n)})()}poll(e,t,n){var s=this;return(0,h.Z)(function*(){const i={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const a=yield s.retrieve(e,t,{...n,headers:i}).withResponse(),o=a.data;switch(o.status){case"in_progress":let l=5e3;if(n?.pollIntervalMs)l=n.pollIntervalMs;else{const c=a.response.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(l=u)}}yield _e(l);break;case"failed":case"completed":return o}}})()}upload(e,t,n){var s=this;return(0,h.Z)(function*(){const i=yield s._client.files.create({file:t,purpose:"assistants"},n);return s.create(e,{file_id:i.id},n)})()}uploadAndPoll(e,t,n){var s=this;return(0,h.Z)(function*(){const i=yield s.upload(e,t,n);return yield s.poll(e,i.id,n)})()}}class At extends q{}!function(r){r.VectorStoreFilesPage=At}(vt||(vt={}));class Ct extends v{create(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}retrieve(e,t,n){return this._client.get(`/vector_stores/${e}/file_batches/${t}`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}cancel(e,t,n){return this._client.post(`/vector_stores/${e}/file_batches/${t}/cancel`,{...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}createAndPoll(e,t,n){var s=this;return(0,h.Z)(function*(){const i=yield s.create(e,t);return yield s.poll(e,i.id,n)})()}listFiles(e,t,n={},s){return B(n)?this.listFiles(e,t,{},n):this._client.getAPIList(`/vector_stores/${e}/file_batches/${t}/files`,At,{query:n,...s,headers:{"OpenAI-Beta":"assistants=v2",...s?.headers}})}poll(e,t,n){var s=this;return(0,h.Z)(function*(){const i={...n?.headers,"X-Stainless-Poll-Helper":"true"};for(n?.pollIntervalMs&&(i["X-Stainless-Custom-Poll-Interval"]=n.pollIntervalMs.toString());;){const{data:a,response:o}=yield s.retrieve(e,t,{...n,headers:i}).withResponse();switch(a.status){case"in_progress":let l=5e3;if(n?.pollIntervalMs)l=n.pollIntervalMs;else{const c=o.headers.get("openai-poll-after-ms");if(c){const u=parseInt(c);isNaN(u)||(l=u)}}yield _e(l);break;case"failed":case"cancelled":case"completed":return a}}})()}uploadAndPoll(e,{files:t,fileIds:n=[]},s){var i=this;return(0,h.Z)(function*(){if(null===t||0==t.length)throw new Error("No files provided to process.");const o=Math.min(s?.maxConcurrency??5,t.length),l=i._client,c=t.values(),u=[...n];function f(){return(f=(0,h.Z)(function*(g){for(let A of g){const b=yield l.files.create({file:A,purpose:"assistants"},s);u.push(b.id)}})).apply(this,arguments)}const d=Array(o).fill(c).map(function p(g){return f.apply(this,arguments)});return yield Vr(d),yield i.createAndPoll(e,{file_ids:u})})()}}Ct||(Ct={});class St extends v{constructor(){super(...arguments),this.files=new vt(this._client),this.fileBatches=new Ct(this._client)}create(e,t){return this._client.post("/vector_stores",{body:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}retrieve(e,t){return this._client.get(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}update(e,t,n){return this._client.post(`/vector_stores/${e}`,{body:t,...n,headers:{"OpenAI-Beta":"assistants=v2",...n?.headers}})}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/vector_stores",wn,{query:e,...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}del(e,t){return this._client.delete(`/vector_stores/${e}`,{...t,headers:{"OpenAI-Beta":"assistants=v2",...t?.headers}})}}class wn extends q{}!function(r){r.VectorStoresPage=wn,r.Files=vt,r.VectorStoreFilesPage=At,r.FileBatches=Ct}(St||(St={}));class Et extends v{constructor(){super(...arguments),this.vectorStores=new St(this._client),this.chat=new ot(this._client),this.assistants=new Qe(this._client),this.threads=new bt(this._client)}}!function(r){r.VectorStores=St,r.VectorStoresPage=wn,r.Chat=ot,r.Assistants=Qe,r.AssistantsPage=rn,r.Threads=bt}(Et||(Et={}));class Pt extends v{create(e,t){return this._client.post("/batches",{body:e,...t})}retrieve(e,t){return this._client.get(`/batches/${e}`,t)}list(e={},t){return B(e)?this.list({},e):this._client.getAPIList("/batches",bn,{query:e,...t})}cancel(e,t){return this._client.post(`/batches/${e}/cancel`,t)}}class bn extends q{}!function(r){r.BatchesPage=bn}(Pt||(Pt={}));class S extends Ir{constructor({baseURL:e=$e("OPENAI_BASE_URL"),apiKey:t=$e("OPENAI_API_KEY"),organization:n=$e("OPENAI_ORG_ID")??null,project:s=$e("OPENAI_PROJECT_ID")??null,...i}={}){if(void 0===t)throw new y("The OPENAI_API_KEY environment variable is missing or empty; either provide it, or instantiate the OpenAI client with an apiKey option, like new OpenAI({ apiKey: 'My API Key' }).");const a={apiKey:t,organization:n,project:s,...i,baseURL:e||"https://api.openai.com/v1"};if(!a.dangerouslyAllowBrowser&&typeof window<"u"&&typeof window.document<"u"&&typeof navigator<"u")throw new y("It looks like you're running in a browser-like environment.\n\nThis is disabled by default, as it risks exposing your secret API credentials to attackers.\nIf you understand the risks and have appropriate mitigations in place,\nyou can set the `dangerouslyAllowBrowser` option to `true`, e.g.,\n\nnew OpenAI({ apiKey, dangerouslyAllowBrowser: true });\n\nhttps://help.openai.com/en/articles/5112595-best-practices-for-api-key-safety\n");super({baseURL:a.baseURL,timeout:a.timeout??6e5,httpAgent:a.httpAgent,maxRetries:a.maxRetries,fetch:a.fetch}),this.completions=new je(this),this.chat=new De(this),this.embeddings=new Le(this),this.files=new Ze(this),this.images=new Ue(this),this.audio=new Xe(this),this.moderations=new Ve(this),this.models=new Je(this),this.fineTuning=new Ke(this),this.beta=new Et(this),this.batches=new Pt(this),this._options=a,this.apiKey=t,this.organization=n,this.project=s}defaultQuery(){return this._options.defaultQuery}defaultHeaders(e){return{...super.defaultHeaders(e),"OpenAI-Organization":this.organization,"OpenAI-Project":this.project,...this._options.defaultHeaders}}authHeaders(e){return{Authorization:`Bearer ${this.apiKey}`}}}S.OpenAI=S,S.OpenAIError=y,S.APIError=P,S.APIConnectionError=ye,S.APIConnectionTimeoutError=Be,S.APIUserAbortError=T,S.NotFoundError=Xt,S.ConflictError=Vt,S.RateLimitError=Gt,S.BadRequestError=qt,S.AuthenticationError=Wt,S.InternalServerError=zt,S.PermissionDeniedError=Ht,S.UnprocessableEntityError=Jt,S.toFile=$t,S.fileFromPath=kt,function(r){r.Page=Kt,r.CursorPage=q,r.Completions=je,r.Chat=De,r.Embeddings=Le,r.Files=Ze,r.FileObjectsPage=Qt,r.Images=Ue,r.Audio=Xe,r.Moderations=Ve,r.Models=Je,r.ModelsPage=Yt,r.FineTuning=Ke,r.Beta=Et,r.Batches=Pt,r.BatchesPage=bn}(S||(S={}));const Gr=S;var zr=$(95);let Kr=(()=>{class r{constructor(t){this.keyService=t,this.keyService.keyInit$.subscribe(n=>{n&&(this.openai=new Gr({apiKey:n,dangerouslyAllowBrowser:!0}))})}process(t){var n=this;return(0,h.Z)(function*(){try{const s=n.openai.chat.completions.create({model:"gpt-3.5-turbo-0125",messages:[{role:"system",content:"You are Marv, a chatbot that answers questions."},{role:"user",content:"Bonjour."}],temperature:0,top_p:1,frequency_penalty:0,presence_penalty:0});return new Promise(i=>{s.then(a=>{console.log(a),i(a.choices[0].message.content)})})}catch(s){console.log(s),n.keyService.resetPassword()}})()}}return r.\u0275fac=function(t){return new(t||r)(w.LFG(zr.B))},r.\u0275prov=w.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})(),Qr=(()=>{class r{constructor(t){this.gptService=t,this.prompt="Ceci est une conversation avec un robot programm\xe9 pour informer sur les expressions fran\xe7aises. Le robot ne r\xe9pond pas aux questions qui ne concernent pas les expressions fran\xe7aises. Le robot ne donne aucune information qui ne concernent pas les expressions fran\xe7aises. Si la r\xe9ponse \xe0 la question pos\xe9 par l'utilisateur ne concernent pas les expressions fran\xe7aises le robot r\xe9pond qu'il ne peut pas r\xe9pondre car il ne r\xe9pond qu'au questions qui concernent les expressions fran\xe7aise. "}process(t){var n=this;return(0,h.Z)(function*(){n.prompt+="\nHumain: "+t+"\nRobot:",console.log({promptSent:n.prompt});const s=yield n.gptService.process(n.prompt);return n.prompt+=s,s})()}}return r.\u0275fac=function(t){return new(t||r)(w.LFG(Kr))},r.\u0275prov=w.Yz7({token:r,factory:r.\u0275fac,providedIn:"root"}),r})();var Yr=$(4144),es=$(7676),vn=$(4006);let ts=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275cmp=w.Xpm({type:r,selectors:[["app-message"]],hostVars:2,hostBindings:function(t,n){2&t&&w.ekj("bot","BOT"==n.message.origin)},inputs:{message:"message"},decls:4,vars:2,consts:[[1,"message-inner",3,"ngClass"],[1,"avatar"],[1,"text"]],template:function(t,n){1&t&&(w.TgZ(0,"div",0),w._UZ(1,"div",1),w.TgZ(2,"div",2),w._uU(3),w.qZA()()),2&t&&(w.Q6J("ngClass","BOT"==n.message.origin?"bot":"user"),w.xp6(3),w.Oqu(n.message.text))},dependencies:[Rt.mk],styles:["[_nghost-%COMP%]{display:flex}[_nghost-%COMP%]:not(.bot){justify-content:flex-end}[_nghost-%COMP%]:not(.bot)   .message-inner[_ngcontent-%COMP%]{background-color:#dcf8c7}[_nghost-%COMP%]:not(.bot)   .message-inner[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{background-image:url(149071.2c79519aa8a73779.png);background-position:top 0px right 0}[_nghost-%COMP%]   .message-inner[_ngcontent-%COMP%]{background-color:#f5f5f5;box-shadow:1px 2px 2px #00000075;align-items:center;display:flex;padding:.5rem 1rem;margin:.5rem;max-width:65%;border-radius:8px}[_nghost-%COMP%]   .message-inner[_ngcontent-%COMP%]   .text[_ngcontent-%COMP%]{margin-left:1rem}[_nghost-%COMP%]   .message-inner[_ngcontent-%COMP%]   .avatar[_ngcontent-%COMP%]{background-image:url(intelligence-artificielle.177fca32fe4b928c.jpg);background-size:auto 100%;min-width:40px;height:40px;border-radius:50%;background-repeat:no-repeat;background-position:top 0px right -8px}"]}),r})();function ns(r,e){1&r&&w._UZ(0,"app-message",4),2&r&&w.Q6J("message",e.$implicit)}const rs=[{path:"talk",component:(()=>{class r{constructor(t){this.chatService=t,this.value="",this.messages=[]}ngOnInit(){}onInput(t){"Enter"==t.key&&(this.sendText(this.value),this.value="",t.preventDefault(),t.stopPropagation())}sendText(t){var n=this;return(0,h.Z)(function*(){console.log("sending: "+t),n.messages.push({origin:fe.USER,text:t});const s=yield n.chatService.process(t);n.messages.push({origin:fe.BOT,text:s})})()}}return r.\u0275fac=function(t){return new(t||r)(w.Y36(Qr))},r.\u0275cmp=w.Xpm({type:r,selectors:[["app-talk"]],decls:4,vars:2,consts:[[1,"message-list"],[3,"message",4,"ngFor","ngForOf"],[1,"chat-input-field"],["matInput","","type","text","placeholder","Entrez votre message... 2ss",3,"ngModel","ngModelChange","keydown"],[3,"message"]],template:function(t,n){1&t&&(w.TgZ(0,"div",0),w.YNc(1,ns,1,1,"app-message",1),w.qZA(),w.TgZ(2,"mat-form-field",2)(3,"textarea",3),w.NdJ("ngModelChange",function(i){return n.value=i})("keydown",function(i){return n.onInput(i)}),w.qZA()()),2&t&&(w.xp6(1),w.Q6J("ngForOf",n.messages),w.xp6(2),w.Q6J("ngModel",n.value))},dependencies:[Rt.sg,Yr.Nt,es.KE,vn.Fj,vn.JJ,vn.On,ts],styles:["[_nghost-%COMP%]{display:block;background-color:#d7d0c9;background-image:url(background.0e2e4ccb6f8f5a46.png);min-width:100vw;min-height:100vh}.chat-input-field[_ngcontent-%COMP%]{width:calc(100vw - 4rem);flex-grow:1;position:absolute;bottom:1rem;margin-left:2rem;position:fixed}.message-list[_ngcontent-%COMP%]{padding:2rem;padding-bottom:200px;width:calc(100vw - 4rem)}[_nghost-%COMP%]     .mat-mdc-text-field-wrapper{background:rgb(245,245,245)}"]}),r})(),children:[]},{path:"**",redirectTo:"talk"}];let ss=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=w.oAB({type:r}),r.\u0275inj=w.cJS({imports:[Cn.Bz.forChild(rs),Cn.Bz]}),r})();var is=$(1132);let as=(()=>{class r{}return r.\u0275fac=function(t){return new(t||r)},r.\u0275mod=w.oAB({type:r}),r.\u0275inj=w.cJS({imports:[Rt.ez,ss,is.m]}),r})()}}]);